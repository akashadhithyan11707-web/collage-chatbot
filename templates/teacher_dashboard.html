<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - College Chatbot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>College Chatbot</h2>
        </div>
        <nav class="sidebar-nav">
            <a href="{{ url_for('teacher_dashboard') }}" class="nav-item active">
                <span>üè†</span> Dashboard
            </a>
            <a href="{{ url_for('profile') }}" class="nav-item">
                <span>üë§</span> Profile
            </a>
            <a href="{{ url_for('about') }}" class="nav-item">
                <span>‚ÑπÔ∏è</span> About
            </a>
            <a href="{{ url_for('logout') }}" class="nav-item">
                <span>üö™</span> Logout
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Navbar -->
        <div class="navbar">
            <button class="mobile-menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
            <h1>Teacher Dashboard</h1>
            <div class="navbar-user">
                <span>Welcome, {{ session.name or session.email_phone }}</span>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div class="dashboard-content">
            <div class="dashboard-header">
                <h2>Student Management</h2>
                <button class="btn btn-primary" onclick="openAddStudentModal()">+ Add Student</button>
            </div>

            <div class="students-table-container">
                <table class="students-table">
                    <thead>
                        <tr>
                            <th>Photo</th>
                            <th>Name</th>
                            <th>Roll Number</th>
                            <th>Department</th>
                            <th>Login ID</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if students %}
                            {% for student in students %}
                            <tr>
                                <td>
                                    {% if student.photo_path %}
                                        <img src="{{ url_for('static', filename=student.photo_path) }}" alt="Photo" class="table-photo">
                                    {% else %}
                                        <div class="table-photo-placeholder">üë§</div>
                                    {% endif %}
                                </td>
                                <td>{{ student.name or 'N/A' }}</td>
                                <td>{{ student.roll_number or 'N/A' }}</td>
                                <td>{{ student.department or 'N/A' }}</td>
                                <td>{{ student.email_phone }}</td>
                                <td>
                                    <button class="btn-icon" onclick="openEditModalWithData({{ student.id }}, {{ {'name': student.name or '', 'roll_number': student.roll_number or '', 'department': student.department or '', 'age': student.age, 'blood_group': student.blood_group or '', 'subjects': student.subjects or '[]', 'parent_details': student.parent_details or '{}'} | tojson | safe }})" title="Edit">‚úèÔ∏è</button>
                                    <button class="btn-icon" onclick="openMarksModal({{ student.id }})" title="Update Marks">üìä</button>
                                    <button class="btn-icon" onclick="openArrearsModal({{ student.id }})" title="Update Arrears">‚ö†Ô∏è</button>
                                    <button class="btn-icon" onclick="openSubjectNotesModal({{ student.id }})" title="Add Subject Notes">üìù</button>
                                    <button class="btn-icon" onclick="openNotesLinkModal({{ student.id }}, '{{ student.notes_link or '' }}')" title="Update Notes Link">üìö</button>
                                    <button class="btn-icon" onclick="openChatbotQuestionsModal({{ student.id }})" title="Manage Chatbot Questions">ü§ñ</button>
                                    <button class="btn-icon" onclick="openResetPasswordModal({{ student.id }})" title="Reset Password">üîë</button>
                                    <button class="btn-icon btn-danger" onclick="deleteStudent({{ student.id }})" title="Delete">üóëÔ∏è</button>
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="6" class="no-data">No students found. Add your first student!</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="addStudentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Student</h2>
                <span class="close-modal" onclick="closeAddStudentModal()">&times;</span>
            </div>
            <form id="addStudentForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label>Email or Phone Number *</label>
                    <input type="text" name="email_phone" required>
                </div>
                <div class="form-group">
                    <label>Password *</label>
                    <input type="password" name="password" required>
                </div>
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" name="name">
                </div>
                <div class="form-group">
                    <label>Roll Number</label>
                    <input type="text" name="roll_number">
                </div>
                <div class="form-group">
                    <label>Department</label>
                    <input type="text" name="department">
                </div>
                <div class="form-group">
                    <label>Student Photo</label>
                    <input type="file" name="photo" accept="image/*">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddStudentModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Student</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div id="editStudentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Student</h2>
                <span class="close-modal" onclick="closeEditModal()">&times;</span>
            </div>
            <form id="editStudentForm">
                <input type="hidden" id="editStudentId" name="student_id">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="editName" name="name">
                </div>
                <div class="form-group">
                    <label>Roll Number</label>
                    <input type="text" id="editRollNumber" name="roll_number">
                </div>
                <div class="form-group">
                    <label>Department</label>
                    <input type="text" id="editDepartment" name="department">
                </div>
                <div class="form-group">
                    <label>Age</label>
                    <input type="number" id="editAge" name="age" min="1" max="100">
                </div>
                <div class="form-group">
                    <label>Blood Group</label>
                    <select id="editBloodGroup" name="blood_group">
                        <option value="">Select Blood Group</option>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Subjects (comma-separated)</label>
                    <input type="text" id="editSubjects" name="subjects" placeholder="e.g., Mathematics, Physics, Chemistry">
                    <small>Enter subjects separated by commas</small>
                </div>
                <h3 style="margin-top: 20px; margin-bottom: 10px;">Parent/Guardian Details</h3>
                <div class="form-group">
                    <label>Parent/Guardian Name</label>
                    <input type="text" id="editParentName" name="parent_name">
                </div>
                <div class="form-group">
                    <label>Relationship</label>
                    <select id="editParentRelationship" name="parent_relationship">
                        <option value="">Select Relationship</option>
                        <option value="Father">Father</option>
                        <option value="Mother">Mother</option>
                        <option value="Guardian">Guardian</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Parent/Guardian Phone</label>
                    <input type="text" id="editParentPhone" name="parent_phone" placeholder="10-digit phone number">
                </div>
                <div class="form-group">
                    <label>Parent/Guardian Email</label>
                    <input type="email" id="editParentEmail" name="parent_email">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div id="resetPasswordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Reset Password</h2>
                <span class="close-modal" onclick="closeResetPasswordModal()">&times;</span>
            </div>
            <form id="resetPasswordForm">
                <input type="hidden" id="resetStudentId" name="student_id">
                <div class="form-group">
                    <label>New Password *</label>
                    <input type="password" id="resetPassword" name="password" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeResetPasswordModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Reset Password</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Update Marks Modal -->
    <div id="updateMarksModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Update Semester Marks</h2>
                <span class="close-modal" onclick="closeMarksModal()">&times;</span>
            </div>
            <form id="updateMarksForm">
                <input type="hidden" id="marksStudentId" name="student_id">
                <div class="form-group">
                    <label>Semester Number *</label>
                    <select id="marksSemester" name="semester" required>
                        <option value="">Select Semester</option>
                        <option value="1">Semester 1</option>
                        <option value="2">Semester 2</option>
                        <option value="3">Semester 3</option>
                        <option value="4">Semester 4</option>
                        <option value="5">Semester 5</option>
                        <option value="6">Semester 6</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Subject Name *</label>
                    <input type="text" id="marksSubject" name="subject" placeholder="e.g., Mathematics, Physics, etc." required>
                </div>
                <div class="form-group">
                    <label>Marks/Percentage *</label>
                    <input type="text" id="marksValue" name="marks" placeholder="e.g., 85% or 425/500" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeMarksModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Marks</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Update Arrears Modal -->
    <div id="updateArrearsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Update Arrears</h2>
                <span class="close-modal" onclick="closeArrearsModal()">&times;</span>
            </div>
            <form id="updateArrearsForm">
                <input type="hidden" id="arrearsStudentId" name="student_id">
                <div class="form-group">
                    <label>Subject Name *</label>
                    <input type="text" id="arrearsSubject" name="subject" placeholder="e.g., Mathematics, Physics..." required>
                </div>
                <div class="form-group">
                    <label>Status *</label>
                    <select id="arrearsStatus" name="status" required>
                        <option value="">Select Status...</option>
                        <option value="Pending">Pending</option>
                        <option value="Cleared">Cleared</option>
                        <option value="In Progress">In Progress</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeArrearsModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Arrears</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Update Subject Notes Modal -->
    <div id="updateSubjectNotesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Subject Notes</h2>
                <span class="close-modal" onclick="closeSubjectNotesModal()">&times;</span>
            </div>
            <form id="updateSubjectNotesForm">
                <input type="hidden" id="subjectNotesStudentId" name="student_id">
                <div class="form-group">
                    <label>Subject Name *</label>
                    <input type="text" id="subjectName" name="subject" placeholder="e.g., Mathematics, Physics, Chemistry..." required>
                </div>
                <div class="form-group">
                    <label>Notes Link (URL) *</label>
                    <input type="url" id="subjectNotesLink" name="notes_link" placeholder="https://example.com/notes" required>
                    <small>Enter a valid URL where subject notes are available</small>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeSubjectNotesModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Notes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Update Notes Link Modal -->
    <div id="updateNotesLinkModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Update General Notes Link</h2>
                <span class="close-modal" onclick="closeNotesLinkModal()">&times;</span>
            </div>
            <form id="updateNotesLinkForm">
                <input type="hidden" id="notesStudentId" name="student_id">
                <div class="form-group">
                    <label>Notes Link (URL) *</label>
                    <input type="url" id="notesLink" name="notes_link" placeholder="https://example.com/notes" required>
                    <small>Enter a valid URL where study notes are available</small>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeNotesLinkModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Notes Link</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Manage Chatbot Questions Modal -->
    <div id="chatbotQuestionsModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>Manage Chatbot Questions</h2>
                <span class="close-modal" onclick="closeChatbotQuestionsModal()">&times;</span>
            </div>
            <form id="chatbotQuestionsForm">
                <input type="hidden" id="chatbotQuestionsStudentId" name="student_id">
                <div id="chatbotQuestionsContainer">
                    <!-- Questions will be dynamically added here -->
                </div>
                <div style="margin-top: 15px;">
                    <button type="button" class="btn btn-secondary" onclick="addChatbotQuestion()" style="margin-right: 10px;">+ Add Question</button>
                    <button type="button" class="btn btn-secondary" onclick="closeChatbotQuestionsModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Questions</button>
                </div>
            </form>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/teacher.js') }}"></script>
</body>
</html>
